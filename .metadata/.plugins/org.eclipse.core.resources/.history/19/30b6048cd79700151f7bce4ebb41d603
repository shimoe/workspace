#include "LPC13xx.h"
#include "gpio.h"
#include "vs-wrc103.h"
#include "ixbus.h"

#define WAIT 500
#define POWER 20000
#define LEFT_SIDE 0
#define RIGHT_SIDE 1

void forward1(void);
void turn_left(void);
void turn_right(void);
int is_black(int side);
int both_black(void);
void to_black(void);


int main(void)
{
	const unsigned short MainCycle = 60;
	Init(MainCycle);

	return 0;
}

void forward1(){
	Mtr_Run_lv(POWER,-POWER,0,0,0,0);
	Wait(130);
	Mtr_Run_lv(0,0,0,0,0,0);
	Wait(WAIT);
}

void turn_left(){
	Mtr_Run_lv(POWER,POWER,0,0,0,0);
	Wait(30);
	Mtr_Run_lv(0,0,0,0,0,0);
	Wait(WAIT);
}

void turn_right(){
	Mtr_Run_lv(-POWER,-POWER,0,0,0,0);
	Wait(30);
	Mtr_Run_lv(0,0,0,0,0,0);
	Wait(WAIT);
}

int is_black(int side){
	if(ADRead(side) > 300){
		return 1;
	}else{
		return 0;
	}
}

int both_black(){
	if(ADRead(0) > 300 && ADRead(1) > 300){
		return 1;
	}else{
		return 0;
	}
}

void to_black(){
	int end;

	end = both_black();

	if(end){
		Mtr_Run_lv(0,0,0,0,0,0);
		fanfare();
	}else{
		if(is_black(LEFT_SIDE) == 1 && is_black(RIGHT_SIDE) == 0){
			turn_left();
		}
		else if(is_black(LEFT_SIDE) == 0 && is_black(RIGHT_SIDE) == 1){
			turn_right();
		}
		else{
			forword1();
		}

	}

}
